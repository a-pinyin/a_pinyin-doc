# A 拼音数据库设计

A 拼音 (2.0) 有 2 个数据库, 都使用 [sqlite3](https://sqlite.org/index.html):

- `a_pinyin-2.db` 内置数据库

- `a_pinyin-2u.db` 用户数据库

其中内置数据库是只读的, 除非版本升级, 否则不可修改内容.

用户数据库用于存放用户配置, 输入历史记录等,
主要用于学习及自定义输入功能.

- 启用 **无痕模式** 时, 用户数据库只读.

- 用户数据库支持 **多设备同步**, 详见 [文档](../多设备同步.md).

- TODO [可选] 支持用户数据库加密

## 数据库表总体规划

- `a_pinyin` 元数据, 与之前的版本兼容 (A 拼音 1.x)

- `a_pinyin_元数据` 新增的元数据表, 用于描述数据库自身的表和数据

- `固定_*` 固定输入数据 (比如符号等)

- `基础_*` 基础数据集

- `u_*` Unicode 数据库

- `用户_*` 用户数据表

- `c1_*` 核心模块 c1 专用数据

- `c2_*` 核心模块 c2 专用数据

- `c3_*` 核心模块 c3 专用数据

## `a_pinyin_元数据`

新的元数据表设计:

- **类型**

  - `表`: 对于数据库中一张表的描述

  - `枚举`: 某表某列是枚举值时, 对每一个值的说明

- **名称**

  `表名` 或 `表.列`

- **值** (可选)

  枚举的具体值

- **备注** (可选)

  更多说明

- **时间** (可选)

  创建时间或更新时间 (REAL Julian (date) time)

## 内置数据库主要设计

- `固定_字符`

  内置的固定输入字符表.

  主要用于 ASCII 符号和中文标点的输入.

  可扩展性: `类型` 可添加新的符号集.

  - `类型`

    - `ASCII` 所有 ASCII 可输入字符 (控制字符除外)

    - `数字` 0-9 数字

    - `英文字母大写` A-Z

    - `英文字母小写` a-z

    - `A` 除空格外的 ASCII 符号 (ASCII 符号输入功能)

    - `中文标点` 常用中文标点 (训练语料高频, 中文标点输入功能)

    - `自定义1` 内置的自定义输入 (符号 2 输入)

  - `文本` 固定输入的内容 (字符)

  - `次数` 在训练语料中出现的次数, 默认 0

- `基础_拼音`

  全拼拼音基础数据.

  - `类型`

    - `全拼` 完整的单个拼音 (不带声调, 普通话)

    - `声母`

    - `韵母`

  - `文本` 拼音

  - `次数` 在训练语料中出现的次数

- `c1_双拼`

  内置双拼方案.

  注意: 双拼和全拼可以多对多关系.

  可扩展性: `名称` 可添加新的方案.

  - `名称` 双拼方案的名称

  - `双拼` 输入的双拼串

  - `pin_yin` 对应的全拼, 下划线分开

- `基础_汉字`

  基础汉字数据.

  注意多音字, 同音字.

  - `全拼` 汉字的读音 (不带声调, 普通话)

  - `声母` 用于快速查找

  - `汉字` 对应的汉字 (文本)

  - `分级` 用于汉字分级

    - `1`
    - `2`
    - `3`

  - `声调` 用 `12345` 表示, `5` 表示轻声, `0` 表示缺乏数据

  - `次数` 在训练语料中出现的次数

- `c1_词典`

  内置词典 (1 元).

  与 A 拼音 1.x 版本相同.
  使用 2 前缀查找法.

  - `文本` 输入的词

  - `次数` 在训练语料中出现的次数

  - `前缀2` 此的前 2 个字, 用于快速查找

- `c1_词典拼音`

  用于 2 前缀查找, 索引.

  - `pin_yin` 全拼, 下划线分隔

  - `p_y` 声母, 下划线分隔

  - `前缀2` 对应的前缀

- `默认配置`

  核心模块等的默认配置.

  - `键` 配置项
  - `值` 具体配置
  - `说明`
  - `备注`

TODO `u_*` Unicode 数据库表设计

## 用户数据库主要设计

注意: 许多表与内置数据库中的相同, 只是多了 `时间` 列,
最后使用时间,格式为 REAL Julian (date) time

- `用户_配置`

  保存设置表.

  注意: 此中有一项, UUID 用于标记此数据库 (多设备同步)

  - `键`
  - `值`
  - `说明`
  - `备注`
  - `时间`

- `用户_字符`

  对应 `固定_字符` 表

  - `类型`
  - `文本`
  - `次数`
  - `时间`

- `用户_字符_索引`

  自定义输入索引表, 对应 `用户_字符`

  - `类型` 内部标识, 比如 `u.1`

  - `名称` 用户自定义输入集合的显示名称

  - `描述`

  - `时间`

- `用户_拼音`

  对应 `基础_拼音` 表

  - `类型`
  - `文本`
  - `次数`
  - `时间`

- `用户_c1_双拼`

  对应 `c1_双拼` 表

  - `名称`
  - `双拼`
  - `pin_yin`
  - `次数`
  - `时间`

- `用户_汉字`

  对应 `基础_汉字` 表

  - `全拼`
  - `声母`
  - `汉字`
  - `声调`
  - `次数`
  - `时间`

- `用户_c1_拼音切分`

  记录用户拼音切分结果.

  - `模式`

    - `全拼`

    - `双拼/` + 方案名, 比如 `双拼/自然码`

    - `九键`

  - `原始`

    用户原始输入

  - `pin_yin`

    切分之后的全拼结果, 下划线分隔

  - `次数`

  - `时间`

- `用户_c1_词典`

  用户输入词典 (1 元).

  - `pin_yin` 全拼序列, 下划线分隔

  - `声调` (可选) 对应声调, 用 `12345` 序列表示

  - `文本` 输入的文本

  - `次数`

  - `时间`

- `用户_c1_词典2`

  用户输入词典 (2 元).

  - `pin_yin`

  - `文本` 本次输入文本

  - `之前` 上次输入文本 (2 元)

  - `次数`

  - `时间`

- `用户_设备`

  用于多设备同步.

  - `序号` 整数, 内部标识

  - `UUID` 用 UUID 标识每个设备

  - `名称` 设备的名称

  - `备注` 设备的备注

  - `设备信息` (JSON) 可扩展

  - `时间` 最后同步时间

  - `添加时间` 首次同步时间

- `用户_剪切板`

  用于剪切板管理器.

  - `序号` 整数

  - `文本` 对应的剪切板内容

  - `时间` 剪切板捕获时间

  - `备注` 用户添加的备注

- `用户_剪切板_标签`

  用于标签化管理剪切板条目, 对应 `用户_剪切板`.

  - `序号` 整数, 对应某一条剪切板记录

  - `标签` 文本, 添加的标签

  - `时间` 添加标签的时间

- `用户_输入统计`

  用于输入统计功能.

  - `键` 某项统计

  - `值` 整数, 统计值

  - `时间` 最后更新时间

  - `备注`
